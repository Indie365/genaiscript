# CLI

The GPTools CLI is a command line packaged as a Node.JS javascript file (`gptools.js`). It is used to run GPTools from the command line.

-   The VS Code extension automatically installs the CLI at `.gptools/gptools.js` in your project.
-   Download `gptools.js` from the [latest release assets](https://github.com/microsoft/gptools/releases/latest).

## run a tool on a file

Runs a gptool on a file and streams the LLM output to stdout.

```bash
node .gptools/gptools.js run <tool> [spec...]
```

where `<tool>` is the id or file path of the tool to run, and `[spec]` is the name of the spec file to run it on.

If `spec` is not a `.gpspec.md` file, a wrapper spec is generated on the fly. In this case, spec can also be a `glob` patterns.

```bash
node .gptools/gptools.js run code-annotator src/*.ts
```

If `[spec]` is not specified, the `stdin` content is used as the spec.

```bash
cat spec.gpspec.md | node .gptools/gptools.js run tool
```

If multiple files are specified, a single spec is generated by concatenating them.

```bash
node .gptools/gptools.js run <tool> src/*.bicep src/*.ts
```

## batch run over many files

To run the tool over many files in a batch mode (one full LLM iteration per file), use the `batch` command.

```bash
node .gptools/gptools.js batch <tool> src/*.bicep
```

The tool will create various JSON Lines files with the results (JSON Lines is a file format where each line is a valid JSON object, which allows for appending results). You can post-process those results using your favorite script environment.

### credentials

The token is read from the environment variables `GPTOOLS_TOKEN`, from `OPENAI_API_KEY/BASE`.
The CLI also supports loading the variables from a `.env` file in the current directory.

The `GPTOOLS_TOKEN` should be formatted as follows

    https://<openai base>#key=<openai api key>

### --out <file|directory>

Saves the results in a JSON file, along with markdown files of the output and the trace.

```bash
node gptools.js run <tool> <spec> --out output/results.json
```

If `file` does not end with `.json`, the path is treated as a directory path.

```bash
node gptools.js run <tool> <spec> --out output
```

### --json

Output the entire response as JSON to the stdout.

### --out-trace <file>

Save the markdown trace to the specified file.

```bash
node gptools.js run <tool> <spec> --out-trace <file>
```

In a GitHub Actions workflow, you can use this feature to save the trace as a step summary (`GITHUB_STEP_SUMMARY`):

```yaml
- name: Run GPTools tool on spec
  run: |
      node gptools.js run <tool> <spec> --out-trace $GITHUB_STEP_SUMMARY
```

### --out-annotations <file>

Emit annotations in the specified file as a JSON array, JSON Lines or a CSV file if the file ends with `.csv`.

```bash
node gptools.js run <tool> <spec> --out-annotations diags.csv
```

Use JSON lines (`.jsonl`) to aggregate annotations from multiple runs in a single file.

```bash
node gptools.js run <tool> <spec> --out-annotations diags.jsonl
```

### --out-data <file>

Emits parsed data as JSON, YAML or JSONL. If a JSON schema is specified
and availabe, the JSON validation result is also stored.

```bash
node gptools.js run <tool> <spec> --out-data data.jsonl
```

### --out-changelogs <file>

Emit changelogs in the specified file as text.

```bash
node gptools.js run <tool> <spec> --out-changelogs changelogs.txt
```

### --prompt

Skips the LLM invocation and only prints the expanded system and user chat messages.

### --retry <number>

Specifies the number of retries when the LLM invocations fails with throttling (429).
Default is 3.

### --retry-delay <number>

Minimum delay between retries in milliseconds.

### --label <label>

Adds a run label that will be used in generating the trace title.

### --cache

Enables LLM caching in JSONL file under `.gptools/tmp/openai.gptools.jsonl`. Caching is enabled by default in VSCode
but not for the CLI.

### --temperature <number>

Overrides the LLM run temperature.

### --top-p <number>

Overrides the LLM run `top_p` value.

### --model <string>

Overrides the LLM model identifier.

### --apply-edits

Apply file modifications to the file system.

## `tools`, manage GPtools

### gptools tools list

Lists the tools available in the current workspace.

## `specs`, manage GPSpecs

### gptools specs list

Lists the specs available in the current workspace.

## `keys`, manage OpenAI Token

Commands to manage the OpenAI token on file. You can also use the `GPTOOLS_TOKEN` environment variable or from `OPENAI_API_KEY/BASE` keys.

### gptools keys set <token>

Stores the OpenAI token in `.gptools/tmp/token.json`.

### gptools keys clear

Clears the OpenAI token from `.gptools/tmp/token.json`.

### gptools keys show

Shows information about the current key.

## `convert`, convert files and URLs to markdown

Extract content from HTML files into flat markdown files, which can be better integrated into a prompt.

```
node gptools.js convert <glob>
```
